# ==========================================
# TinkuBot Microservices
# Variables de Entorno Compartidas
# ==========================================

# ------------------------------------------
# CONFIGURACIÓN GENERAL
# ------------------------------------------
NODE_ENV=production
SERVER_HOST=0.0.0.0
LOG_LEVEL=INFO

# ------------------------------------------
# SUPABASE (Base de datos y autenticación)
# ------------------------------------------
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your-supabase-service-key
SUPABASE_URI=postgresql://postgres:password@host:5432/postgres?sslmode=require
SUPABASE_PROVIDERS_TABLE=providers
SUPABASE_PROVIDERS_BUCKET=tinkubot-providers

# ------------------------------------------
# DATABASE (Para servicios que usan SQL directo)
# ------------------------------------------
DATABASE_URL=postgresql://postgres:password@host:5432/postgres?sslmode=require

# ------------------------------------------
# OPENAI API
# ------------------------------------------
OPENAI_API_KEY=your-openai-api-key

# ------------------------------------------
# REDIS (Cache y sesiones)
# ------------------------------------------
REDIS_URL=redis://redis:6379
REDIS_PASSWORD=

# ------------------------------------------
# FRONTEND
# ------------------------------------------
FRONTEND_SERVICE_PORT=5000
ADMIN_USER=admin
ADMIN_PASSWORD=your-admin-password
PROVIDERS_PENDING_LIMIT=100

# ------------------------------------------
# AI SERVICE CLIENTES
# ------------------------------------------
AI_SERVICE_CLIENTES_URL=http://ai-clientes:8001
CLIENTES_SERVER_PORT=8001
AI_SERVICE_CLIENTES_PORT=8001
USE_AI_EXTRACTION=true
WHATSAPP_CLIENTES_URL=http://wa-gateway:7000
WHATSAPP_PROVEEDORES_URL=http://wa-gateway:7000
WHATSAPP_CLIENTES_ACCOUNT_ID=bot-clientes

# ------------------------------------------
# AI SEARCH
# ------------------------------------------
AI_SEARCH_PORT=8000
AI_SEARCH_INTERNAL_TOKEN=your-internal-token-here
EMBEDDINGS_TIMEOUT_SECONDS=30
EMBEDDINGS_RETRY_ATTEMPTS=2
EMBEDDINGS_RETRY_BACKOFF_MS=300
BILLING_FILTER_ENABLED=false
MAX_SEARCH_RESULTS=20
SEARCH_TIMEOUT_MS=5000

# ------------------------------------------
# LEADS Y BILLING
# ------------------------------------------
FREE_LEADS_DEFAULT=5
LEAD_DEDUPE_WINDOW_DAYS=7
FEEDBACK_DELAY_SECONDS=7200

# ------------------------------------------
# SEARCH CIRCUIT BREAKER
# ------------------------------------------
SEARCH_POOL_TIMEOUT_SECONDS=2
SEARCH_MAX_INFLIGHT=60
SEARCH_MAX_QUEUE=80
SEARCH_CB_FAILURE_THRESHOLD=5
SEARCH_CB_OPEN_SECONDS=20
SEARCH_CB_HALF_OPEN_SUCCESS_THRESHOLD=2

# ------------------------------------------
# WA-GATEWAY (Go + whatsmeow)
# ------------------------------------------
WA_GATEWAY_PORT=7000
WA_CLIENTES_DEVICE_JID=593999999999:85@s.whatsapp.net
WA_PROVEEDORES_DEVICE_JID=593999999999:82@s.whatsapp.net
DATABASE_PATH=file:./data/wa-gateway.db?_foreign_keys=on
WA_RATE_LIMIT_MAX_PER_HOUR=20
WA_RATE_LIMIT_MAX_PER24H=100

# ------------------------------------------
# WA-GATEWAY - WEBHOOK CONFIGURATION
# ------------------------------------------
AI_CLIENTES_URL=http://ai-clientes:8001
AI_PROVEEDORES_URL=http://ai-proveedores:8002
WEBHOOK_ENDPOINT=/handle-whatsapp-message
WEBHOOK_TIMEOUT_MS=10000
WEBHOOK_RETRY_ATTEMPTS=3

# ------------------------------------------
# AI SERVICE PROVEEDORES
# ------------------------------------------
PROVEEDORES_SERVER_PORT=8002
AI_SERVICE_PROVEEDORES_PORT=8002
AI_SERVICE_PROVEEDORES_URL=http://ai-proveedores:8002
AI_PROVEEDORES_INTERNAL_TOKEN=your-internal-token-here

# ------------------------------------------
# AVAILABILITY
# ------------------------------------------
AVAILABILITY_TIMEOUT_SECONDS=45
TASK_POLL_INTERVAL_SECONDS=60

# ------------------------------------------
# SESSION Y FLOW
# ------------------------------------------
FLOW_TTL_SECONDS=86400
SESSION_TIMEOUT_ENABLED=true

# ------------------------------------------
# UVICORN WORKERS (Por servicio)
# ------------------------------------------
AI_CLIENTES_UVICORN_WORKERS=2
AI_PROVEEDORES_UVICORN_WORKERS=2
AI_SEARCH_UVICORN_WORKERS=2
